# Generated by Django 4.2.8 on 2026-01-07 00:32

from django.conf import settings
from django.db import migrations, models
import django.db.models.deletion
import django.utils.timezone


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name='Artwork',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('base_code', models.CharField(blank=True, editable=False, help_text='图稿的主编码，如：ART202412001，不包含版本号', max_length=50, null=True, verbose_name='图稿主编码')),
                ('version', models.IntegerField(default=1, help_text='图稿版本号，从1开始递增', verbose_name='版本号')),
                ('name', models.CharField(max_length=200, verbose_name='图稿名称')),
                ('cmyk_colors', models.JSONField(blank=True, default=list, help_text='选中的CMYK颜色，如：["C", "M", "K"]', verbose_name='CMYK颜色')),
                ('other_colors', models.JSONField(blank=True, default=list, help_text='其他颜色列表，如：["528C", "金色"]', verbose_name='其他颜色')),
                ('imposition_size', models.CharField(blank=True, help_text='如：420x594mm、889x1194mm等', max_length=100, verbose_name='拼版尺寸')),
                ('confirmed', models.BooleanField(default=False, help_text='设计部是否已确认该图稿', verbose_name='已确认')),
                ('confirmed_at', models.DateTimeField(blank=True, null=True, verbose_name='确认时间')),
                ('notes', models.TextField(blank=True, verbose_name='备注')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='创建时间')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='更新时间')),
                ('confirmed_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='confirmed_artworks', to=settings.AUTH_USER_MODEL, verbose_name='确认人')),
            ],
            options={
                'verbose_name': '图稿',
                'verbose_name_plural': '图稿管理',
                'ordering': ['-base_code', '-version'],
            },
        ),
        migrations.CreateModel(
            name='Customer',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=200, verbose_name='客户名称')),
                ('contact_person', models.CharField(blank=True, max_length=100, verbose_name='联系人')),
                ('phone', models.CharField(blank=True, max_length=50, verbose_name='联系电话')),
                ('email', models.EmailField(blank=True, max_length=254, verbose_name='邮箱')),
                ('address', models.TextField(blank=True, verbose_name='地址')),
                ('notes', models.TextField(blank=True, verbose_name='备注')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='创建时间')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='更新时间')),
                ('salesperson', models.ForeignKey(blank=True, help_text='负责该客户的业务员', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='customers', to=settings.AUTH_USER_MODEL, verbose_name='业务员')),
            ],
            options={
                'verbose_name': '客户',
                'verbose_name_plural': '客户管理',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='Department',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=50, unique=True, verbose_name='部门名称')),
                ('code', models.CharField(max_length=20, unique=True, verbose_name='部门编码')),
                ('sort_order', models.IntegerField(default=0, verbose_name='排序')),
                ('is_active', models.BooleanField(default=True, verbose_name='是否启用')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='创建时间')),
                ('parent', models.ForeignKey(blank=True, help_text='上级部门，用于建立部门层级关系（如生产部下有多个车间）', null=True, on_delete=django.db.models.deletion.CASCADE, related_name='children', to='workorder.department', verbose_name='上级部门')),
            ],
            options={
                'verbose_name': '部门',
                'verbose_name_plural': '部门管理',
                'ordering': ['sort_order', 'code'],
            },
        ),
        migrations.CreateModel(
            name='Die',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('code', models.CharField(blank=True, max_length=50, unique=True, verbose_name='刀模编码')),
                ('name', models.CharField(max_length=200, verbose_name='刀模名称')),
                ('size', models.CharField(blank=True, help_text='如：420x594mm、889x1194mm等', max_length=100, verbose_name='尺寸')),
                ('material', models.CharField(blank=True, help_text='如：木板、胶板等', max_length=100, verbose_name='材质')),
                ('thickness', models.CharField(blank=True, help_text='如：3mm、5mm等', max_length=50, verbose_name='厚度')),
                ('notes', models.TextField(blank=True, verbose_name='备注')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='创建时间')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='更新时间')),
            ],
            options={
                'verbose_name': '刀模',
                'verbose_name_plural': '刀模管理',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='EmbossingPlate',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('code', models.CharField(blank=True, max_length=50, unique=True, verbose_name='压凸版编码')),
                ('name', models.CharField(max_length=200, verbose_name='压凸版名称')),
                ('size', models.CharField(blank=True, help_text='如：420x594mm、889x1194mm等', max_length=100, verbose_name='尺寸')),
                ('material', models.CharField(blank=True, help_text='如：铜版、锌版等', max_length=100, verbose_name='材质')),
                ('thickness', models.CharField(blank=True, help_text='如：3mm、5mm等', max_length=50, verbose_name='厚度')),
                ('notes', models.TextField(blank=True, verbose_name='备注')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='创建时间')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='更新时间')),
            ],
            options={
                'verbose_name': '压凸版',
                'verbose_name_plural': '压凸版管理',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='FoilingPlate',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('code', models.CharField(blank=True, max_length=50, unique=True, verbose_name='烫金版编码')),
                ('name', models.CharField(max_length=200, verbose_name='烫金版名称')),
                ('foiling_type', models.CharField(choices=[('gold', '烫金'), ('silver', '烫银')], default='gold', help_text='该版是烫金还是烫银', max_length=20, verbose_name='类型')),
                ('size', models.CharField(blank=True, help_text='如：420x594mm、889x1194mm等', max_length=100, verbose_name='尺寸')),
                ('material', models.CharField(blank=True, help_text='如：铜版、锌版等', max_length=100, verbose_name='材质')),
                ('thickness', models.CharField(blank=True, help_text='如：3mm、5mm等', max_length=50, verbose_name='厚度')),
                ('notes', models.TextField(blank=True, verbose_name='备注')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='创建时间')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='更新时间')),
            ],
            options={
                'verbose_name': '烫金版',
                'verbose_name_plural': '烫金版管理',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='Material',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=200, verbose_name='物料名称')),
                ('code', models.CharField(max_length=50, unique=True, verbose_name='物料编码')),
                ('specification', models.CharField(blank=True, max_length=200, verbose_name='规格')),
                ('unit', models.CharField(default='个', max_length=20, verbose_name='单位')),
                ('unit_price', models.DecimalField(decimal_places=2, default=0, max_digits=10, verbose_name='单价')),
                ('stock_quantity', models.DecimalField(decimal_places=2, default=0, max_digits=10, verbose_name='库存数量')),
                ('need_cutting', models.BooleanField(default=False, help_text='该物料是否需要开料工序处理', verbose_name='需要开料')),
                ('notes', models.TextField(blank=True, verbose_name='备注')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='创建时间')),
            ],
            options={
                'verbose_name': '物料',
                'verbose_name_plural': '物料管理',
                'ordering': ['code'],
            },
        ),
        migrations.CreateModel(
            name='Process',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=100, verbose_name='工序名称')),
                ('code', models.CharField(max_length=50, unique=True, verbose_name='工序编码')),
                ('description', models.TextField(blank=True, verbose_name='工序描述')),
                ('standard_duration', models.IntegerField(default=0, verbose_name='标准工时(小时)')),
                ('sort_order', models.IntegerField(default=0, verbose_name='排序')),
                ('is_active', models.BooleanField(default=True, verbose_name='是否启用')),
                ('is_builtin', models.BooleanField(default=False, help_text='内置工序不可删除，code字段不可编辑', verbose_name='是否内置')),
                ('task_generation_rule', models.CharField(choices=[('artwork', '按图稿生成任务（每个图稿一个任务，数量为1）'), ('die', '按刀模生成任务（每个刀模一个任务，数量为1）'), ('product', '按产品生成任务（每个产品一个任务）'), ('material', '按物料生成任务（每个物料一个任务）'), ('general', '生成通用任务（一个工序一个任务）')], default='general', help_text='该工序如何生成任务', max_length=20, verbose_name='任务生成规则')),
                ('requires_artwork', models.BooleanField(default=False, help_text='该工序是否需要图稿（CTP版）', verbose_name='需要图稿')),
                ('requires_die', models.BooleanField(default=False, help_text='该工序是否需要刀模', verbose_name='需要刀模')),
                ('requires_foiling_plate', models.BooleanField(default=False, help_text='该工序是否需要烫金版', verbose_name='需要烫金版')),
                ('requires_embossing_plate', models.BooleanField(default=False, help_text='该工序是否需要压凸版', verbose_name='需要压凸版')),
                ('artwork_required', models.BooleanField(default=True, help_text='如果为True，选择该工序时必须选择图稿；如果为False，图稿可选（但需要手动创建设计任务，设计不属于施工单工序）', verbose_name='图稿必选')),
                ('die_required', models.BooleanField(default=True, help_text='如果为True，选择该工序时必须选择刀模；如果为False，刀模可选（但需要手动创建设计任务，设计不属于施工单工序）', verbose_name='刀模必选')),
                ('foiling_plate_required', models.BooleanField(default=True, help_text='如果为True，选择该工序时必须选择烫金版；如果为False，烫金版可选（但需要手动创建设计任务，设计不属于施工单工序）', verbose_name='烫金版必选')),
                ('embossing_plate_required', models.BooleanField(default=True, help_text='如果为True，选择该工序时必须选择压凸版；如果为False，压凸版可选（但需要手动创建设计任务，设计不属于施工单工序）', verbose_name='压凸版必选')),
                ('is_parallel', models.BooleanField(default=False, help_text='该工序是否可以与其他工序并行执行（如制版、模切等）', verbose_name='可并行执行')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='创建时间')),
            ],
            options={
                'verbose_name': '工序',
                'verbose_name_plural': '工序管理',
                'ordering': ['sort_order', 'code'],
            },
        ),
        migrations.CreateModel(
            name='Product',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=200, verbose_name='产品名称')),
                ('code', models.CharField(max_length=50, unique=True, verbose_name='产品编码')),
                ('specification', models.CharField(blank=True, max_length=200, verbose_name='规格')),
                ('unit', models.CharField(default='件', max_length=20, verbose_name='单位')),
                ('unit_price', models.DecimalField(decimal_places=2, default=0, max_digits=10, verbose_name='单价')),
                ('description', models.TextField(blank=True, verbose_name='产品描述')),
                ('is_active', models.BooleanField(default=True, verbose_name='是否启用')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='创建时间')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='更新时间')),
                ('default_processes', models.ManyToManyField(blank=True, help_text='创建施工单时将自动添加这些工序', to='workorder.process', verbose_name='默认工序')),
            ],
            options={
                'verbose_name': '产品',
                'verbose_name_plural': '产品管理',
                'ordering': ['code'],
            },
        ),
        migrations.CreateModel(
            name='ProductGroup',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('name', models.CharField(max_length=200, verbose_name='产品组名称')),
                ('code', models.CharField(max_length=50, unique=True, verbose_name='产品组编码')),
                ('description', models.TextField(blank=True, verbose_name='描述')),
                ('is_active', models.BooleanField(default=True, verbose_name='是否启用')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='创建时间')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='更新时间')),
            ],
            options={
                'verbose_name': '产品组',
                'verbose_name_plural': '产品组管理',
                'ordering': ['code'],
            },
        ),
        migrations.CreateModel(
            name='ProductGroupItem',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('item_name', models.CharField(help_text='如：天盒、地盒', max_length=200, verbose_name='子产品名称')),
                ('sort_order', models.IntegerField(default=0, verbose_name='排序')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='创建时间')),
                ('product', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='workorder.product', verbose_name='产品')),
                ('product_group', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='items', to='workorder.productgroup', verbose_name='产品组')),
            ],
            options={
                'verbose_name': '产品组子项',
                'verbose_name_plural': '产品组子项管理',
                'ordering': ['product_group', 'sort_order'],
                'unique_together': {('product_group', 'product')},
            },
        ),
        migrations.CreateModel(
            name='WorkOrder',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('order_number', models.CharField(editable=False, max_length=50, unique=True, verbose_name='施工单号')),
                ('printing_type', models.CharField(choices=[('none', '不需要印刷'), ('front', '正面印刷'), ('back', '背面印刷'), ('self_reverse', '自反印刷'), ('reverse_gripper', '反咬口印刷'), ('register', '套版印刷')], default='none', help_text='印刷形式，选择图稿时必选', max_length=20, verbose_name='印刷形式')),
                ('printing_cmyk_colors', models.JSONField(blank=True, default=list, help_text='选中的CMYK颜色，如：["C", "M", "K"]', verbose_name='印刷CMYK颜色')),
                ('printing_other_colors', models.JSONField(blank=True, default=list, help_text='其他颜色列表，如：["528C", "金色"]', verbose_name='印刷其他颜色')),
                ('status', models.CharField(choices=[('pending', '待开始'), ('in_progress', '进行中'), ('paused', '已暂停'), ('completed', '已完成'), ('cancelled', '已取消')], default='pending', max_length=20, verbose_name='状态')),
                ('priority', models.CharField(choices=[('low', '低'), ('normal', '普通'), ('high', '高'), ('urgent', '紧急')], default='normal', max_length=20, verbose_name='优先级')),
                ('order_date', models.DateField(default=django.utils.timezone.now, verbose_name='下单日期')),
                ('delivery_date', models.DateField(verbose_name='交货日期')),
                ('actual_delivery_date', models.DateField(blank=True, null=True, verbose_name='实际交货日期')),
                ('production_quantity', models.IntegerField(blank=True, help_text='单位：车', null=True, verbose_name='生产数量')),
                ('defective_quantity', models.IntegerField(blank=True, help_text='单位：车', null=True, verbose_name='预损数量')),
                ('total_amount', models.DecimalField(decimal_places=2, default=0, max_digits=12, verbose_name='总金额')),
                ('design_file', models.FileField(blank=True, null=True, upload_to='designs/', verbose_name='设计文件')),
                ('notes', models.TextField(blank=True, verbose_name='备注')),
                ('approval_status', models.CharField(choices=[('pending', '待审核'), ('approved', '已通过'), ('rejected', '已拒绝')], default='pending', max_length=20, verbose_name='审核状态')),
                ('approved_at', models.DateTimeField(blank=True, null=True, verbose_name='审核时间')),
                ('approval_comment', models.TextField(blank=True, help_text='业务员审核意见', verbose_name='审核意见')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='创建时间')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='更新时间')),
                ('approved_by', models.ForeignKey(blank=True, help_text='业务员审核人', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approved_orders', to=settings.AUTH_USER_MODEL, verbose_name='审核人')),
                ('artworks', models.ManyToManyField(blank=True, help_text='关联的图稿，用于CTP制版，支持多个图稿（如纸卡双面印刷的面版和底版）', related_name='work_orders', to='workorder.artwork', verbose_name='图稿（CTP版）')),
                ('created_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='created_orders', to=settings.AUTH_USER_MODEL, verbose_name='创建人')),
                ('customer', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='workorder.customer', verbose_name='客户')),
                ('dies', models.ManyToManyField(blank=True, help_text='关联的刀模，用于模切工序，支持多个刀模', related_name='work_orders', to='workorder.die', verbose_name='刀模')),
                ('embossing_plates', models.ManyToManyField(blank=True, help_text='关联的压凸版，用于压凸工序，支持多个压凸版', related_name='work_orders', to='workorder.embossingplate', verbose_name='压凸版')),
                ('foiling_plates', models.ManyToManyField(blank=True, help_text='关联的烫金版，用于烫金工序，支持多个烫金版', related_name='work_orders', to='workorder.foilingplate', verbose_name='烫金版')),
                ('manager', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='managed_orders', to=settings.AUTH_USER_MODEL, verbose_name='制表人')),
                ('product_group_item', models.ForeignKey(blank=True, help_text='如果该施工单是产品组的一部分，关联到对应的子产品', null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='work_orders', to='workorder.productgroupitem', verbose_name='产品组子项')),
            ],
            options={
                'verbose_name': '施工单',
                'verbose_name_plural': '施工单管理',
                'ordering': ['-created_at'],
                'permissions': [('change_approved_workorder', '可以编辑已审核的施工单')],
            },
        ),
        migrations.CreateModel(
            name='WorkOrderProcess',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('sequence', models.IntegerField(default=0, verbose_name='工序顺序')),
                ('status', models.CharField(choices=[('pending', '待开始'), ('in_progress', '进行中'), ('completed', '已完成'), ('skipped', '已跳过')], default='pending', max_length=20, verbose_name='状态')),
                ('planned_start_time', models.DateTimeField(blank=True, null=True, verbose_name='计划开始时间')),
                ('planned_end_time', models.DateTimeField(blank=True, null=True, verbose_name='计划结束时间')),
                ('actual_start_time', models.DateTimeField(blank=True, null=True, verbose_name='实际开始时间')),
                ('actual_end_time', models.DateTimeField(blank=True, null=True, verbose_name='实际结束时间')),
                ('duration_hours', models.DecimalField(blank=True, decimal_places=2, default=0, max_digits=6, verbose_name='耗时(小时)')),
                ('quantity_completed', models.IntegerField(default=0, verbose_name='完成数量')),
                ('quantity_defective', models.IntegerField(default=0, verbose_name='不良品数量')),
                ('notes', models.TextField(blank=True, verbose_name='备注')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='创建时间')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='更新时间')),
                ('department', models.ForeignKey(blank=True, help_text='指定该工序由哪个部门生产', null=True, on_delete=django.db.models.deletion.PROTECT, to='workorder.department', verbose_name='生产部门')),
                ('operator', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='operated_processes', to=settings.AUTH_USER_MODEL, verbose_name='操作员')),
                ('process', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='workorder.process', verbose_name='工序')),
                ('work_order', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='order_processes', to='workorder.workorder', verbose_name='施工单')),
            ],
            options={
                'verbose_name': '施工单工序',
                'verbose_name_plural': '施工单工序管理',
                'ordering': ['work_order', 'sequence'],
                'unique_together': {('work_order', 'sequence')},
            },
        ),
        migrations.CreateModel(
            name='WorkOrderTask',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('task_type', models.CharField(choices=[('plate_making', '制版任务'), ('cutting', '开料任务'), ('printing', '印刷任务'), ('foiling', '烫金任务'), ('embossing', '压凸任务'), ('die_cutting', '模切任务'), ('packaging', '包装任务'), ('general', '通用任务')], default='general', help_text='任务类型，用于区分不同的任务生成规则', max_length=20, verbose_name='任务类型')),
                ('work_content', models.TextField(help_text='具体的施工内容描述', verbose_name='施工内容')),
                ('production_quantity', models.IntegerField(default=0, help_text='该任务需要生产的数量', verbose_name='生产数量')),
                ('quantity_completed', models.IntegerField(default=0, help_text='任务完成数量，可自动计算或手动输入', verbose_name='完成数量')),
                ('auto_calculate_quantity', models.BooleanField(default=True, help_text='是否自动计算完成数量', verbose_name='自动计算数量')),
                ('production_requirements', models.TextField(blank=True, help_text='生产过程中的特殊要求', verbose_name='生产要求')),
                ('status', models.CharField(choices=[('pending', '待开始'), ('in_progress', '进行中'), ('completed', '已完成'), ('cancelled', '已取消')], default='pending', max_length=20, verbose_name='状态')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='创建时间')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='更新时间')),
                ('artwork', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='tasks', to='workorder.artwork', verbose_name='关联图稿')),
                ('die', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='tasks', to='workorder.die', verbose_name='关联刀模')),
                ('embossing_plate', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='tasks', to='workorder.embossingplate', verbose_name='关联压凸版')),
                ('foiling_plate', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='tasks', to='workorder.foilingplate', verbose_name='关联烫金版')),
                ('material', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='tasks', to='workorder.material', verbose_name='关联物料')),
                ('product', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.CASCADE, related_name='tasks', to='workorder.product', verbose_name='关联产品')),
                ('work_order_process', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='tasks', to='workorder.workorderprocess', verbose_name='工序')),
            ],
            options={
                'verbose_name': '施工单任务',
                'verbose_name_plural': '施工单任务管理',
                'ordering': ['work_order_process', 'created_at'],
            },
        ),
        migrations.CreateModel(
            name='WorkOrderMaterial',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('material_size', models.CharField(blank=True, help_text='如：A4、210x297mm等', max_length=100, verbose_name='尺寸')),
                ('material_usage', models.CharField(blank=True, help_text='如：1000张、50平方米等', max_length=100, verbose_name='用量')),
                ('need_cutting', models.BooleanField(default=False, help_text='该物料是否需要开料工序处理', verbose_name='需要开料')),
                ('purchase_status', models.CharField(choices=[('pending', '待采购'), ('ordered', '已下单'), ('received', '已回料'), ('cut', '已开料'), ('completed', '已完成')], default='pending', help_text='物料的采购和开料状态', max_length=20, verbose_name='采购状态')),
                ('purchase_date', models.DateField(blank=True, help_text='采购下单日期', null=True, verbose_name='采购日期')),
                ('received_date', models.DateField(blank=True, help_text='物料回料日期', null=True, verbose_name='回料日期')),
                ('cut_date', models.DateField(blank=True, help_text='切料组开料日期', null=True, verbose_name='开料日期')),
                ('notes', models.TextField(blank=True, verbose_name='备注')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='创建时间')),
                ('material', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='workorder.material', verbose_name='物料')),
                ('work_order', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='materials', to='workorder.workorder', verbose_name='施工单')),
            ],
            options={
                'verbose_name': '施工单物料',
                'verbose_name_plural': '施工单物料管理',
                'ordering': ['work_order', 'material'],
            },
        ),
        migrations.CreateModel(
            name='WorkOrderApprovalLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('approval_status', models.CharField(choices=[('pending', '待审核'), ('approved', '已通过'), ('rejected', '已拒绝')], max_length=20, verbose_name='审核状态')),
                ('approved_at', models.DateTimeField(auto_now_add=True, verbose_name='审核时间')),
                ('approval_comment', models.TextField(blank=True, help_text='审核意见或说明', verbose_name='审核意见')),
                ('rejection_reason', models.TextField(blank=True, help_text='审核拒绝时的拒绝原因', verbose_name='拒绝原因')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='创建时间')),
                ('approved_by', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, related_name='approval_logs', to=settings.AUTH_USER_MODEL, verbose_name='审核人')),
                ('work_order', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='approval_logs', to='workorder.workorder', verbose_name='施工单')),
            ],
            options={
                'verbose_name': '施工单审核历史',
                'verbose_name_plural': '施工单审核历史管理',
                'ordering': ['-approved_at', '-created_at'],
            },
        ),
        migrations.CreateModel(
            name='UserProfile',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='创建时间')),
                ('updated_at', models.DateTimeField(auto_now=True, verbose_name='更新时间')),
                ('departments', models.ManyToManyField(blank=True, help_text='用户所属的部门（可多选）', to='workorder.department', verbose_name='所属部门')),
                ('user', models.OneToOneField(on_delete=django.db.models.deletion.CASCADE, related_name='profile', to=settings.AUTH_USER_MODEL, verbose_name='用户')),
            ],
            options={
                'verbose_name': '用户扩展信息',
                'verbose_name_plural': '用户扩展信息管理',
            },
        ),
        migrations.CreateModel(
            name='TaskLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('log_type', models.CharField(choices=[('update_quantity', '更新数量'), ('complete', '强制完成'), ('status_change', '状态变更')], max_length=20, verbose_name='日志类型')),
                ('content', models.TextField(help_text='操作内容描述', verbose_name='内容')),
                ('quantity_before', models.IntegerField(blank=True, null=True, verbose_name='更新前数量')),
                ('quantity_after', models.IntegerField(blank=True, null=True, verbose_name='更新后数量')),
                ('quantity_increment', models.IntegerField(blank=True, help_text='本次操作的数量增量', null=True, verbose_name='数量增量')),
                ('status_before', models.CharField(blank=True, max_length=20, null=True, verbose_name='更新前状态')),
                ('status_after', models.CharField(blank=True, max_length=20, null=True, verbose_name='更新后状态')),
                ('completion_reason', models.TextField(blank=True, help_text='强制完成时的理由说明', verbose_name='完成理由')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='创建时间')),
                ('operator', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL, verbose_name='操作员')),
                ('task', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='logs', to='workorder.workordertask', verbose_name='任务')),
            ],
            options={
                'verbose_name': '任务操作日志',
                'verbose_name_plural': '任务操作日志',
                'ordering': ['-created_at'],
            },
        ),
        migrations.CreateModel(
            name='ProcessLog',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('log_type', models.CharField(choices=[('start', '开始'), ('pause', '暂停'), ('resume', '恢复'), ('complete', '完成'), ('note', '备注')], max_length=20, verbose_name='日志类型')),
                ('content', models.TextField(verbose_name='内容')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='创建时间')),
                ('operator', models.ForeignKey(null=True, on_delete=django.db.models.deletion.SET_NULL, to=settings.AUTH_USER_MODEL, verbose_name='操作员')),
                ('work_order_process', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='logs', to='workorder.workorderprocess', verbose_name='工序')),
            ],
            options={
                'verbose_name': '工序日志',
                'verbose_name_plural': '工序日志',
                'ordering': ['-created_at'],
            },
        ),
        migrations.AddField(
            model_name='department',
            name='processes',
            field=models.ManyToManyField(blank=True, help_text='该部门负责的工序', to='workorder.process', verbose_name='工序'),
        ),
        migrations.AddField(
            model_name='artwork',
            name='dies',
            field=models.ManyToManyField(blank=True, help_text='该图稿关联的刀模', to='workorder.die', verbose_name='关联刀模'),
        ),
        migrations.AddField(
            model_name='artwork',
            name='embossing_plates',
            field=models.ManyToManyField(blank=True, help_text='该图稿关联的压凸版', to='workorder.embossingplate', verbose_name='关联压凸版'),
        ),
        migrations.AddField(
            model_name='artwork',
            name='foiling_plates',
            field=models.ManyToManyField(blank=True, help_text='该图稿关联的烫金版', to='workorder.foilingplate', verbose_name='关联烫金版'),
        ),
        migrations.CreateModel(
            name='WorkOrderProduct',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('quantity', models.IntegerField(default=1, verbose_name='数量')),
                ('unit', models.CharField(default='件', max_length=20, verbose_name='单位')),
                ('specification', models.TextField(blank=True, verbose_name='产品规格')),
                ('sort_order', models.IntegerField(default=0, verbose_name='排序')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='创建时间')),
                ('product', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='workorder.product', verbose_name='产品')),
                ('work_order', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='products', to='workorder.workorder', verbose_name='施工单')),
            ],
            options={
                'verbose_name': '施工单产品',
                'verbose_name_plural': '施工单产品管理',
                'ordering': ['work_order', 'sort_order'],
                'unique_together': {('work_order', 'product', 'sort_order')},
            },
        ),
        migrations.CreateModel(
            name='ProductMaterial',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('material_size', models.CharField(blank=True, help_text='如：A4、210x297mm等', max_length=100, verbose_name='尺寸')),
                ('material_usage', models.CharField(blank=True, help_text='如：1000张、50平方米等', max_length=100, verbose_name='用量')),
                ('need_cutting', models.BooleanField(default=False, help_text='该物料是否需要开料工序处理', verbose_name='需要开料')),
                ('notes', models.TextField(blank=True, verbose_name='备注')),
                ('sort_order', models.IntegerField(default=0, verbose_name='排序')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='创建时间')),
                ('material', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='workorder.material', verbose_name='物料')),
                ('product', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='default_materials', to='workorder.product', verbose_name='产品')),
            ],
            options={
                'verbose_name': '产品默认物料',
                'verbose_name_plural': '产品默认物料管理',
                'ordering': ['product', 'sort_order'],
                'unique_together': {('product', 'material')},
            },
        ),
        migrations.CreateModel(
            name='FoilingPlateProduct',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('quantity', models.IntegerField(default=1, help_text='该产品在烫金版中的数量', verbose_name='数量')),
                ('sort_order', models.IntegerField(default=0, verbose_name='排序')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='创建时间')),
                ('foiling_plate', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='products', to='workorder.foilingplate', verbose_name='烫金版')),
                ('product', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='workorder.product', verbose_name='产品')),
            ],
            options={
                'verbose_name': '烫金版产品',
                'verbose_name_plural': '烫金版产品管理',
                'ordering': ['foiling_plate', 'sort_order'],
                'unique_together': {('foiling_plate', 'product')},
            },
        ),
        migrations.CreateModel(
            name='EmbossingPlateProduct',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('quantity', models.IntegerField(default=1, help_text='该产品在压凸版中的数量', verbose_name='数量')),
                ('sort_order', models.IntegerField(default=0, verbose_name='排序')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='创建时间')),
                ('embossing_plate', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='products', to='workorder.embossingplate', verbose_name='压凸版')),
                ('product', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='workorder.product', verbose_name='产品')),
            ],
            options={
                'verbose_name': '压凸版产品',
                'verbose_name_plural': '压凸版产品管理',
                'ordering': ['embossing_plate', 'sort_order'],
                'unique_together': {('embossing_plate', 'product')},
            },
        ),
        migrations.CreateModel(
            name='DieProduct',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('quantity', models.IntegerField(default=1, help_text='该产品在刀模中的数量', verbose_name='数量')),
                ('sort_order', models.IntegerField(default=0, verbose_name='排序')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='创建时间')),
                ('die', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='products', to='workorder.die', verbose_name='刀模')),
                ('product', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='workorder.product', verbose_name='产品')),
            ],
            options={
                'verbose_name': '刀模产品',
                'verbose_name_plural': '刀模产品管理',
                'ordering': ['die', 'sort_order'],
                'unique_together': {('die', 'product')},
            },
        ),
        migrations.CreateModel(
            name='ArtworkProduct',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('imposition_quantity', models.IntegerField(default=1, help_text='该产品在图稿中的拼版数量', verbose_name='拼版数量')),
                ('sort_order', models.IntegerField(default=0, verbose_name='排序')),
                ('created_at', models.DateTimeField(auto_now_add=True, verbose_name='创建时间')),
                ('artwork', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='products', to='workorder.artwork', verbose_name='图稿')),
                ('product', models.ForeignKey(on_delete=django.db.models.deletion.PROTECT, to='workorder.product', verbose_name='产品')),
            ],
            options={
                'verbose_name': '图稿产品',
                'verbose_name_plural': '图稿产品管理',
                'ordering': ['artwork', 'sort_order'],
                'unique_together': {('artwork', 'product')},
            },
        ),
        migrations.AlterUniqueTogether(
            name='artwork',
            unique_together={('base_code', 'version')},
        ),
    ]
