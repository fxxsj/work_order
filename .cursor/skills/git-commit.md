# Git 提交 Agent Skill

## Skill 描述

帮助用户创建规范的 git 提交消息,分析代码变更,生成符合项目规范的提交信息,并执行 git 提交和推送操作。

## 功能特性

- 分析当前代码变更(git diff)
- 生成符合项目规范的中文提交消息
- 支持添加文件到暂存区
- 执行 git commit 命令
- 自动推送到远程仓库
- 遵循项目的提交消息风格

## 项目提交消息规范

根据项目历史,提交消息应遵循以下风格:

### 基本格式

```
<type>: <中文简短描述>

<中文详细说明(可选)>
```

**格式说明**:
- `<type>`: 使用英文类型标识(小写),如 `feat`、`fix`、`docs` 等
- `<中文简短描述>`: 使用中文描述变更内容,简洁明了
- 冒号 `:` 后面有一个空格
- 详细说明全部使用中文

### 提交类型

- **feat**: 新功能
- **fix**: 修复 bug
- **docs**: 文档更新
- **refactor**: 代码重构
- **perf**: 性能优化
- **test**: 测试相关
- **chore**: 构建/工具配置等
- **style**: 代码格式调整
- **revert**: 回滚

### 消息风格

- 冒号前使用英文类型标识(如 `feat`、`fix`)
- 冒号后使用中文描述变更内容
- 简洁明了,突出变更目的
- 重点关注"为什么"而不是"做什么"
- 详细说明全部使用中文

**示例**:
- `feat: 添加登录功能`
- `fix: 修复任务完成数量计算错误`
- `docs: 更新快速开始文档`
- `perf: 优化前端页面加载性能`
- `refactor: 重构用户权限验证逻辑`

## 使用流程

### 自动提交流程

当用户要求提交修改时,按以下步骤执行:

1. **检查变更状态**
   ```bash
   git status
   ```

2. **查看变更内容**
   ```bash
   git diff
   git diff --cached
   ```

3. **分析变更并生成提交消息**
   - 读取变更的文件列表
   - 分析变更的类型(新功能/bug修复/文档等)
   - 生成符合项目风格的提交消息(`type: 中文描述`)
   - 考虑变更的影响范围

4. **添加文件到暂存区** (如需要)
   - 添加指定的修改文件
   - 或者添加所有变更: `git add .`

5. **执行提交**
   ```bash
   git commit -m "生成的提交消息"
   ```

6. **推送到远程仓库**
   ```bash
   git push
   ```

7. **验证提交**
   ```bash
   git log -1
   git status
   ```

### 交互式提交流程

如果需要用户确认,可以:

1. 展示变更摘要
2. 提供生成的提交消息供用户确认
3. 等待用户批准后执行提交和推送

## 提交消息生成规则

### 分析代码变更

1. **查看变更文件**
   - 前端文件 (`frontend/`): 关注 UI、组件、API 调用
   - 后端文件 (`backend/`): 关注模型、视图、业务逻辑
   - 文档文件 (`docs/`): 标记为 `docs:` 类型
   - 配置文件: 根据变更内容判断类型

2. **判断变更类型**
   - 新增功能 → `feat:`
   - 修复问题 → `fix:`
   - 优化改进 → `perf:` 或 `refactor:`
   - 文档修改 → `docs:`
   - 格式调整 → `style:`

3. **生成提交消息**
   - 格式: `英文类型: 中文描述`
   - 核心描述(1-2个动词+名词)
   - 突出业务价值
   - 详细说明全部使用中文

### 示例

**场景1: 新增功能**
```
变更: 新增施工单批量导出功能
提交: feat: 新增施工单批量导出功能,支持 Excel 格式导出
```

**场景2: 修复 bug**
```
变更: 修复任务完成数量计算错误
提交: fix: 修复任务完成数量计算逻辑错误
```

**场景3: 文档更新**
```
变更: 更新快速开始文档
提交: docs: 更新快速开始文档,添加最新功能说明
```

**场景4: 性能优化**
```
变更: 优化前端页面加载性能
提交: perf: 优化前端页面加载性能,实施代码分割和懒加载
```

**场景5: 代码重构**
```
变更: 重构用户权限验证逻辑
提交: refactor: 重构用户权限验证逻辑,提高代码可维护性
```

**场景6: 多功能组合**
```
变更: 工作台页面优化(角色展示+通知+紧急提醒)
提交: feat: 优化工作台页面,添加角色差异化展示和通知提醒功能
```

**场景7: 修复多个问题**
```
变更: 修复登录和注册功能的问题
提交: fix: 修复用户登录和注册功能的多个问题,提升用户体验
```

## 注意事项

### 提交前检查

- ✅ 确认没有提交敏感信息(密码、密钥等)
- ✅ 确认代码已通过必要的测试
- ✅ 确认提交消息准确描述变更内容
- ✅ 避免提交临时代码或调试代码
- ✅ 提交前先 `git pull` 确保代码是最新的

### 提交最佳实践

- ✅ 一个提交对应一个逻辑完整的变更
- ✅ 提交消息格式: `type: 中文描述`
- ✅ 提交消息简洁明了,突出目的
- ✅ 避免过大的提交(拆分为多个小提交)
- ✅ 提交后立即推送到远程仓库

### 推送最佳实践

- ✅ 提交后立即执行 `git push`
- ✅ 如果推送失败,先 `git pull` 解决冲突
- ✅ 避免推送前有大量未提交的本地提交
- ✅ 保持本地和远程仓库同步

### 错误处理

- 如果 pre-commit hook 失败,尝试再次提交以包含自动更改
- 如果提交失败,根据错误信息调整并重试
- 如果遇到合并冲突,先解决冲突再提交
- 如果推送失败,先执行 `git pull` 更新代码

## 快捷指令示例

### 查看变更
```bash
git status
git diff
git diff --staged
```

### 查看提交历史
```bash
git log --oneline -10
git log -1 --stat
```

### 提交和推送
```bash
git add .                      # 添加所有变更
git add <file>                 # 添加指定文件
git commit -m "type: 中文描述" # 提交
git push                       # 推送到远程
git commit --amend             # 修改最后一次提交
```

### 同步远程仓库
```bash
git pull                       # 拉取远程更新
git push                       # 推送本地提交
git pull --rebase              # 拉取并变基
```

## 相关命令

- `git add` - 添加文件到暂存区
- `git commit` - 提交变更
- `git push` - 推送到远程仓库
- `git pull` - 拉取远程更新
- `git status` - 查看工作区状态
- `git diff` - 查看变更内容
- `git log` - 查看提交历史
- `git show` - 查看提交详情

## 扩展功能

### 创建 Pull Request

如果需要,可以扩展此 skill 以支持:
- 自动创建 Pull Request
- 生成 PR 描述
- 关联相关 Issue

### 分支管理

- 创建新分支: `git checkout -b feature/xxx`
- 合并分支: `git merge branch-name`
- 推送分支: `git push -u origin branch-name`
- 删除分支: `git branch -d branch-name`

### 标签管理

- 创建标签: `git tag -a v1.0.0 -m "版本描述"`
- 推送标签: `git push --tags`

---

**最后更新**: 2026-01-10
**适用项目**: work_order (印刷施工单跟踪系统)
**技术栈**: Vue.js + Django REST Framework
