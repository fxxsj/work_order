# P0功能快速验证指南

> 验证所有P0功能是否正常工作

**更新日期**: 2026-01-18

---

## 🚀 启动服务

### 1. 后端服务

```bash
cd /home/chenjiaxing/文档/work_order/backend

# 激活虚拟环境
source venv/bin/activate

# 启动Django服务器
python manage.py runserver
```

后端将运行在：http://localhost:8000

### 2. 前端服务

```bash
cd /home/chenjiaxing/文档/work_order/frontend

# 启动Vue开发服务器
npm run serve
```

前端将运行在：http://localhost:8080

---

## ✅ 验证清单

### 一、数据库验证

#### 1.1 检查数据表是否创建

**方法**：访问 Django Admin 后台
- URL: http://localhost:8000/admin/
- 使用超级管理员账号登录

**验证项**：
- [ ] 看到"财务管理"分组
  - [ ] Cost centers (成本中心)
  - [ ] Cost items (成本项目)
  - [ ] Production costs (生产成本)
  - [ ] Invoices (发票)
  - [ ] Payments (收款记录)
  - [ ] Payment plans (收款计划)
  - [ ] Statements (对账单)
- [ ] 看到"库存管理"分组
  - [ ] Product stocks (成品库存)
  - [ ] Stock ins (入库单)
  - [ ] Stock outs (出库单)
  - [ ] Delivery orders (发货单)
  - [ ] Delivery items (发货明细)
  - [ ] Quality inspections (质量检验)

#### 1.2 创建测试数据

**在 Django Admin 中创建**：

1. **成本中心**：
   - 代码：CC001
   - 名称：生产成本中心
   - 类型：production

2. **成本项目**：
   - 代码：CI001
   - 名称：直接材料
   - 类型：material
   - 分摊方法：quantity_based

3. **测试成品库存**：
   - 选择一个产品
   - 批次号：BATCH001
   - 数量：100
   - 库位：A01-01

---

### 二、后端API验证

#### 2.1 测试API端点

使用浏览器或 curl 测试以下端点：

**库存模块**：
```bash
# 成品库存列表
curl http://localhost:8000/api/product-stocks/

# 库存预警
curl http://localhost:8000/api/product-stocks/low_stock/

# 发货单列表
curl http://localhost:8000/api/delivery-orders/

# 质检列表
curl http://localhost:8000/api/quality-inspections/
```

**财务模块**：
```bash
# 发票列表
curl http://localhost:8000/api/invoices/

# 收款列表
curl http://localhost:8000/api/payments/

# 成本列表
curl http://localhost:8000/api/production-costs/

# 对账单列表
curl http://localhost:8000/api/statements/
```

**预期结果**：
- 返回 JSON 格式数据
- 状态码为 200
- 数据包含 `results` 数组（即使为空）

---

### 三、前端界面验证

#### 3.1 检查菜单导航

访问前端：http://localhost:8080

**验证项**：
- [ ] 登录成功后，看到左侧导航菜单
- [ ] 看到"库存管理"菜单组（箱子图标）
  - [ ] 点击展开，看到3个子菜单
    - [ ] 成品库存
    - [ ] 发货管理
    - [ ] 质量检验
- [ ] 看到"财务管理"菜单组（钱包图标）
  - [ ] 点击展开，看到4个子菜单
    - [ ] 发票管理
    - [ ] 收款管理
    - [ ] 成本核算
    - [ ] 对账管理

#### 3.2 测试页面访问

逐个点击菜单项，验证页面是否正常加载：

**库存管理页面**：
- [ ] 成品库存页面：http://localhost:8080/inventory/stocks
  - [ ] 显示统计卡片（总库存数、产品种类、低库存、过期批次）
  - [ ] 显示搜索和过滤表单
  - [ ] 显示数据表格
  - [ ] 显示分页组件
- [ ] 发货管理页面：http://localhost:8080/inventory/delivery
  - [ ] 显示搜索和过滤表单
  - [ ] 显示发货单列表
  - [ ] 状态显示正确（待发货、已发货、运输中、已签收等）
- [ ] 质量检验页面：http://localhost:8080/inventory/quality
  - [ ] 显示搜索和过滤表单
  - [ ] 显示质检单列表
  - [ ] 检验类型和结果显示正确

**财务管理页面**：
- [ ] 发票管理页面：http://localhost:8080/finance/invoices
  - [ ] 显示统计卡片（总金额、待收款、已收款）
  - [ ] 显示搜索和过滤表单
  - [ ] 显示发票列表
  - [ ] 状态显示正确（草稿、已开具、已发送等）
- [ ] 收款管理页面：http://localhost:8080/finance/payments
  - [ ] 显示统计卡片（总收款、已核销、未核销、收款笔数）
  - [ ] 显示搜索和过滤表单
  - [ ] 显示收款记录列表
- [ ] 成本核算页面：http://localhost:8080/finance/costs
  - [ ] 显示统计卡片（订单数量、平均材料成本等）
  - [ ] 显示搜索和过滤表单
  - [ ] 显示成本列表
  - [ ] 成本差异用颜色标识
- [ ] 对账管理页面：http://localhost:8080/finance/statements
  - [ ] 显示搜索和过滤表单
  - [ ] 显示对账单列表
  - [ ] 余额显示正确

#### 3.3 测试路由高亮

- [ ] 点击任意菜单项
- [ ] 菜单项高亮显示
- [ ] 面包屑导航显示正确
- [ ] 浏览器地址栏URL正确

---

### 四、功能验证（有测试数据后）

#### 4.1 成品库存功能

- [ ] 创建库存记录
  - [ ] 批次号自动生成
  - [ ] 过期天数正确计算
- [ ] 查看库存详情
  - [ ] 对话框正常显示
  - [ ] 所有字段正确显示
- [ ] 库存预警
  - [ ] 点击"库存预警"按钮
  - [ ] 显示低库存列表对话框
- [ ] 过期库存
  - [ ] 点击"过期库存"按钮
  - [ ] 显示过期库存列表对话框

#### 4.2 发货管理功能

- [ ] 创建发货单
  - [ ] 表单验证正常
  - [ ] 发货单号自动生成
- [ ] 查看发货详情
  - [ ] 发货信息完整显示
  - [ ] 发货明细表格正常显示
- [ ] 发货操作
  - [ ] 点击"发货"按钮
  - [ ] 确认对话框显示
  - [ ] 状态正确更新
- [ ] 签收操作
  - [ ] 点击"签收"按钮
  - [ ] 签收对话框显示
  - [ ] 可以选择签收状态
  - [ ] 可以输入签收备注

#### 4.3 发票管理功能

- [ ] 创建发票
  - [ ] 表单验证正常
  - [ ] 发票号自动生成
  - [ ] 税额自动计算
- [ ] 查看发票详情
  - [ ] 发票信息完整显示
  - [ ] 发票明细表格正常显示
- [ ] 提交发票
  - [ ] 点击"提交"按钮
  - [ ] 状态正确更新
- [ ] 审核发票
  - [ ] 点击"审核"按钮
  - [ ] 审核对话框显示
  - [ ] 可以通过或拒绝

---

## 🐛 常见问题排查

### 问题1：前端页面空白

**可能原因**：
- API接口调用失败
- 路由配置错误

**排查方法**：
1. 打开浏览器开发者工具（F12）
2. 查看Console标签的错误信息
3. 查看Network标签的API请求状态

**解决方案**：
- 确保后端服务正常运行
- 检查API接口URL是否正确
- 检查CORS配置

### 问题2：菜单不显示

**可能原因**：
- 路由配置错误
- 权限问题

**排查方法**：
1. 检查浏览器Console是否有错误
2. 检查 router/index.js 配置

**解决方案**：
- 确认路由配置正确
- 检查用户权限

### 问题3：Django Admin看不到新模型

**可能原因**：
- 数据库迁移未执行
- Admin未注册

**排查方法**：
```bash
# 检查数据库表是否存在
python manage.py shell
from workorder.models import ProductStock, Invoice
print(ProductStock._meta.db_table)
print(Invoice._meta.db_table)
```

**解决方案**：
```bash
# 执行数据库迁移
python manage.py migrate

# 重启服务器
python manage.py runserver
```

### 问题4：API返回404错误

**可能原因**：
- URL路由配置错误
- ViewSet未注册

**排查方法**：
```bash
# 检查路由配置
python manage.py show_urls | grep -E "(product-stocks|invoices|delivery-orders)"
```

**解决方案**：
- 检查 urls.py 中的路由注册
- 确认 views/__init__.py 导出正确

---

## 📊 验证结果记录

### 数据库
- [ ] 所有13个新表已创建
- [ ] Django Admin 可以访问所有新模型
- [ ] 可以创建测试数据

### 后端API
- [ ] 所有API端点返回200状态码
- [ ] JSON数据格式正确
- [ ] 分页功能正常

### 前端界面
- [ ] 菜单导航正常显示
- [ ] 所有7个页面可以访问
- [ ] 页面布局正常
- [ ] 统计卡片显示正确
- [ ] 数据表格显示正确
- [ ] 过滤和搜索功能正常

### 整体评估
- [ ] 前端功能：_______%
- [ ] 后端功能：_______%
- [ ] 数据完整性：_______%
- [ ] 用户体验：_______%

---

## ✅ 验证通过标准

### 最小可用标准（MVP）
- [x] 数据库表已创建
- [x] Django Admin 可以管理数据
- [x] 前端菜单可以访问
- [x] 所有页面可以正常显示
- [x] API接口可以正常调用

### 完整功能标准
- [ ] 可以创建完整的业务数据
- [ ] 可以编辑和删除数据
- [ ] 状态流转正常
- [ ] 统计数据准确
- [ ] 搜索和过滤功能正常
- [ ] 权限控制正常

---

## 🎯 下一步行动

验证通过后，可以：

1. **创建初始数据**
   - 成本中心结构
   - 成本项目清单
   - 库位信息

2. **用户培训**
   - 演示新功能
   - 编写操作手册
   - 录制视频教程

3. **性能优化**
   - 添加数据库索引
   - 优化查询性能
   - 前端懒加载

4. **功能扩展**
   - 添加数据导出
   - 添加报表功能
   - 添加数据图表

---

**文档版本**: v1.0.0
**最后更新**: 2026-01-18
**验证状态**: 待验证 ⏳
