# 工作台页面优化分析

**最后更新时间**：2026-01-08  
**分析范围**：Dashboard.vue 工作台页面展示内容优化

---

## 一、当前工作台页面分析

### 1.1 当前展示内容

当前工作台页面（`Dashboard.vue`）展示的内容包括：

1. **待审核施工单提醒**（仅业务员可见）
   - 显示待审核施工单数量
   - 点击可跳转到待审核列表

2. **统计卡片**（4个）
   - 施工单总数
   - 已完成
   - 进行中
   - 即将到期（7天内）

3. **状态分布表格**
   - 按状态统计施工单数量
   - 显示占比
   - 点击可跳转到对应状态的列表

4. **优先级分布表格**
   - 按优先级统计施工单数量
   - 显示占比
   - 点击可跳转到对应优先级的列表

5. **最近的施工单列表**
   - 显示最近创建的10个施工单
   - 包含施工单号、客户、产品、状态、进度、交货日期

### 1.2 存在的问题

#### 1.2.1 缺少角色差异化展示 ⚠️

**问题描述**：
- 所有用户看到的内容基本相同
- 没有根据用户角色（业务员、生产主管、操作员、设计员）显示不同的内容
- 用户需要的信息被淹没在大量不相关的数据中

**影响**：
- 操作员需要查看"我的任务"，但工作台没有显示
- 生产主管需要查看"部门任务统计"，但工作台没有显示
- 设计员需要查看"待确认的图稿/版型"，但工作台没有显示

#### 1.2.2 缺少任务相关统计 ⚠️

**问题描述**：
- 后端API已经提供了丰富的任务统计数据（`task_statistics`），但前端没有使用
- 工作台只显示施工单统计，没有显示任务统计
- 任务是系统的核心操作单元，应该在工作台突出显示

**后端已提供但未使用的数据**：
- `task_statistics.total_count`：任务总数
- `task_statistics.status_statistics`：任务状态统计
- `task_statistics.type_statistics`：任务类型统计
- `task_statistics.department_statistics`：部门任务统计
- `task_statistics.completion_rate`：任务完成率

#### 1.2.3 缺少通知提醒 ⚠️

**问题描述**：
- 系统有通知功能（`Notification`），但工作台没有显示未读通知
- 用户需要到通知页面才能看到通知
- 重要通知（如审核通过/拒绝、任务分派）应该在工作台显示

#### 1.2.4 缺少快速操作入口 ⚠️

**问题描述**：
- 工作台只显示统计数据，缺少快速操作入口
- 用户需要频繁操作的内容（如"我的任务"、"待处理事项"）没有直接入口
- 缺少"待开始工序"、"待分派任务"等快速操作入口

#### 1.2.5 缺少生产效率分析展示 ⚠️

**问题描述**：
- 后端API已经提供了生产效率分析数据（`efficiency_analysis`），但前端没有使用
- 生产主管需要查看生产效率数据，但工作台没有显示

**后端已提供但未使用的数据**：
- `efficiency_analysis.process_completion_rate`：工序完成率
- `efficiency_analysis.avg_completion_time_hours`：平均完成时间
- `efficiency_analysis.task_completion_rate`：任务完成率
- `efficiency_analysis.defective_rate`：不良品率

#### 1.2.6 缺少紧急事项提醒 ⚠️

**问题描述**：
- 只显示"即将到期"的施工单，但缺少其他紧急事项提醒
- 如：紧急优先级的施工单、超期未完成的工序、待分派的任务等

---

## 二、优化方案

### 2.1 角色差异化展示

#### 2.1.1 业务员工作台

**重点内容**：
1. **待审核施工单提醒**（已有，保留）
2. **我的施工单统计**
   - 我负责的客户施工单总数
   - 待审核数量
   - 进行中数量
   - 已完成数量
3. **最近的施工单**（已有，保留）
4. **客户统计**（使用 `business_analysis.customer_statistics`）

#### 2.1.2 生产主管工作台

**重点内容**：
1. **部门任务统计**
   - 部门任务总数
   - 待开始任务
   - 进行中任务
   - 已完成任务
   - 任务完成率
2. **生产效率分析**
   - 工序完成率
   - 平均完成时间
   - 任务完成率
   - 不良品率
3. **部门任务分布**（使用 `task_statistics.department_statistics`）
4. **待开始工序提醒**
   - 显示可以开始的工序列表
   - 提供快速开始入口

#### 2.1.3 操作员工作台

**重点内容**：
1. **我的任务统计**
   - 我的任务总数
   - 待开始任务
   - 进行中任务
   - 已完成任务
2. **我的待处理任务**
   - 显示我分派的任务列表（最多10条）
   - 提供快速更新数量入口
3. **任务进度提醒**
   - 显示即将到期的任务
   - 显示紧急优先级的任务

#### 2.1.4 设计员工作台

**重点内容**：
1. **待确认图稿/版型**
   - 显示需要确认的图稿列表
   - 显示需要确认的刀模列表
   - 显示需要确认的烫金版列表
   - 显示需要确认的压凸版列表
2. **我的确认统计**
   - 已确认数量
   - 待确认数量

#### 2.1.5 管理员工作台

**重点内容**：
1. **全局统计**（当前内容，保留）
2. **任务统计**（新增）
3. **生产效率分析**（新增）
4. **业务分析**（新增）
   - 客户统计
   - 产品统计

### 2.2 新增功能模块

#### 2.2.1 通知提醒模块

**位置**：工作台顶部，在待审核提醒下方

**内容**：
- 显示未读通知数量
- 显示最近3条重要通知（审核通过/拒绝、任务分派、工序完成等）
- 点击可跳转到通知列表

**实现**：
- 调用通知API获取未读数量
- 显示通知列表（最多3条）

#### 2.2.2 任务统计模块

**位置**：统计卡片区域，新增任务相关卡片

**内容**：
- 任务总数卡片
- 待开始任务卡片
- 进行中任务卡片
- 已完成任务卡片

**数据来源**：`statistics.task_statistics`

#### 2.2.3 生产效率分析模块

**位置**：图表区域，新增生产效率卡片

**内容**：
- 工序完成率
- 平均完成时间
- 任务完成率
- 不良品率

**数据来源**：`statistics.efficiency_analysis`

#### 2.2.4 快速操作模块

**位置**：工作台右侧或顶部

**内容**：
- **业务员**：创建施工单、查看待审核
- **生产主管**：开始工序、分派任务、查看部门统计
- **操作员**：更新任务数量、查看我的任务
- **设计员**：确认图稿、确认版型

### 2.3 布局优化

#### 2.3.1 响应式布局

**当前问题**：
- 统计卡片固定4列，在小屏幕上显示不佳

**优化方案**：
- 使用响应式布局，根据屏幕大小调整列数
- 移动端：1列
- 平板：2列
- 桌面：4列

#### 2.3.2 内容优先级

**优化方案**：
- 顶部：通知提醒、待审核提醒（重要且紧急）
- 中部：统计卡片（核心数据）
- 下部：详细列表和图表（辅助信息）

---

## 三、实施计划

### 3.1 第一阶段：基础优化（1-2天）

1. ✅ **添加通知提醒模块**
   - 显示未读通知数量
   - 显示最近3条重要通知

2. ✅ **添加任务统计卡片**
   - 任务总数
   - 待开始任务
   - 进行中任务
   - 已完成任务

3. ✅ **角色判断逻辑**
   - 根据用户角色显示不同的内容
   - 使用 `userRole.js` 工具函数

### 3.2 第二阶段：角色差异化（2-3天）

1. ✅ **业务员工作台**
   - 优化我的施工单统计
   - 添加客户统计

2. ✅ **生产主管工作台**
   - 添加部门任务统计
   - 添加生产效率分析
   - 添加待开始工序提醒

3. ✅ **操作员工作台**
   - 添加我的任务统计
   - 添加我的待处理任务列表
   - 添加任务进度提醒

4. ✅ **设计员工作台**
   - 添加待确认图稿/版型列表
   - 添加我的确认统计

### 3.3 第三阶段：高级功能（3-5天）

1. ⚠️ **生产效率分析图表**
   - 工序完成率趋势图
   - 任务完成率趋势图
   - 不良品率趋势图

2. ⚠️ **快速操作入口**
   - 根据角色显示不同的快速操作按钮
   - 提供常用功能的快捷入口

3. ⚠️ **紧急事项提醒**
   - 紧急优先级施工单提醒
   - 超期未完成工序提醒
   - 待分派任务提醒

---

## 四、技术实现

### 4.1 数据获取

**当前实现**：
```javascript
// 只获取施工单统计
const stats = await workOrderAPI.getStatistics()
```

**优化后**：
```javascript
// 获取完整统计数据（包含任务统计、生产效率分析等）
const stats = await workOrderAPI.getStatistics()

// 获取通知数据
const notifications = await notificationAPI.getUnreadCount()
const recentNotifications = await notificationAPI.getList({ page_size: 3 })

// 根据角色获取特定数据
if (isOperator) {
  const myTasks = await taskAPI.getList({ assigned_operator: currentUser.id, page_size: 10 })
}
```

### 4.2 角色判断

**使用工具函数**：
```javascript
import { hasRole, hasAnyRole } from '@/utils/userRole'

// 判断是否为业务员
const isSalesperson = hasRole(this.$store, '业务员')

// 判断是否为生产主管
const isSupervisor = hasAnyRole(this.$store, ['生产主管', '管理员'])

// 判断是否为操作员
const isOperator = hasAnyRole(this.$store, ['操作员', '生产主管'])
```

### 4.3 组件结构

**优化后的组件结构**：
```vue
<template>
  <div class="dashboard">
    <!-- 通知提醒 -->
    <NotificationAlert v-if="unreadNotificationCount > 0" />
    
    <!-- 待审核提醒（业务员） -->
    <ApprovalAlert v-if="isSalesperson" />
    
    <!-- 统计卡片（根据角色显示不同内容） -->
    <StatCards :role="userRole" :statistics="statistics" />
    
    <!-- 主要内容区域（根据角色显示不同内容） -->
    <RoleBasedContent :role="userRole" :statistics="statistics" />
    
    <!-- 最近的施工单（所有角色） -->
    <RecentWorkOrders />
  </div>
</template>
```

---

## 五、预期效果

### 5.1 用户体验提升

1. **信息更聚焦**：用户看到的内容都是与自己相关的
2. **操作更便捷**：快速操作入口让用户能快速完成常用操作
3. **提醒更及时**：通知提醒让用户不会错过重要信息

### 5.2 工作效率提升

1. **减少点击次数**：常用功能直接在工作台显示
2. **减少查找时间**：相关信息集中展示
3. **提高响应速度**：重要事项及时提醒

---

## 六、后续优化方向

### 6.1 数据可视化

- 添加图表展示统计数据（如折线图、柱状图）
- 添加甘特图展示施工单进度
- 添加热力图展示任务分布

### 6.2 个性化定制

- 允许用户自定义工作台显示内容
- 允许用户调整卡片顺序
- 允许用户隐藏不需要的模块

### 6.3 移动端优化

- 优化移动端显示
- 支持手势操作
- 支持离线查看

---

## 相关文档

- [系统使用流程分析](./SYSTEM_USAGE_ANALYSIS.md)
- [任务管理系统当前状态](./TASK_MANAGEMENT_CURRENT_STATUS.md)
- [用户角色指南](./USER_ROLE_GUIDE.md)

