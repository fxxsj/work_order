# Phase 04: Task Assignment Core - Context

**Gathered:** 2026-01-31
**Status:** Ready for planning

<domain>
## Phase Boundary

实现任务分配的核心功能 - 主管手动分配任务给部门内的操作员，以及操作员自主认领未分配的任务。包含并发控制防止两个操作员同时认领同一任务。

关键能力：
- 主管分配：部门主管可以将任务分配给部门内的任何操作员
- 操作员认领：操作员可以认领未分配的任务
- 并发控制：防止两个操作员同时认领同一任务（乐观锁）
- 分配限制：任务一次只能分配给一个操作员
- 最大任务数：操作员达到最大任务数时分配失败

**不包含**：任务列表页面（Phase 5）、角色专用界面（Phase 7）
</domain>

<decisions>
## Implementation Decisions

### 主管分配交互
- 分配界面位置：拖拽分配（Claude's Discretion）
- 分配确认：可撤销机制（Claude's Discretion）
- 批量分配：混合模式（Claude's Discretion）- 批量分配在部门面板，单个在任务列表
- 分配反馈：分级提示（Claude's Discretion）- 单个简单提示，批量显示摘要

### 操作员认领流程
- 认领界面位置：任务列表页面（未分配任务显示认领按钮）
- 认领方式：单个认领（每个任务有独立的认领按钮）
- 认领后撤销：条件撤销（Claude's Discretion）- 未开始可撤销，进行中需主管批准
- 认领前信息：直接认领（无需额外信息）

### 并发冲突处理
- 冲突提示信息：分级信息（Claude's Discretion）- 简单提示通常情况，详细信息调试时
- 重试机制：提供重试按钮（Claude's Discretion）
- 成功方通知：广播通知（向部门所有相关操作员发送任务已被认领的通知）
- 乐观锁实现：技术选择（Claude's Discretion）- 根据并发级别选择最佳实现方式

### Claude's Discretion
以下区域由Claude在规划/实现时灵活决定：

**主管分配交互**：
- 拖拽分配的具体交互模式（拖拽源、目标、视觉反馈）
- 可撤销机制的撤销时间窗口和撤销条件
- 批量分配的具体操作方式和选择模式
- 分配反馈的详细程度和展示形式

**操作员认领流程**：
- 条件撤销的具体条件（任务状态、时间限制等）
- 撤销操作的审批流程（如果需要）
- 认领按钮的视觉状态和禁用条件

**并发冲突处理**：
- 冲突提示的信息详细程度（何时显示详细信息）
- 重试按钮的实现方式（自动重试次数、间隔）
- 广播通知的通知范围和触发条件
- 乐观锁的具体技术选择（select_for_update vs version字段）

</decisions>

<specifics>
## Specific Ideas

无特定要求 - 开放采用标准实践。关键点：
- 主管需要直观的分配方式，支持快速操作
- 操作员认领应该简单直接，不需要额外输入
- 并发冲突处理要友好，提供清晰的错误信息和恢复路径
- 通知机制要保证相关人员及时了解任务状态变化

</specifics>

<deferred>
## Deferred Ideas

None - 讨论保持在阶段范围内

</deferred>

---

*Phase: 04-Task-Assignment-Core*
*Context gathered: 2026-01-31*
